pipeline {
    agent any

    stages {
        stage('clone') {
            steps {
             git branch: 'main', url: 'https://github.com/bhanukumari/php-terraform.git' 
            }
        }
         stage('terraform init') {
            steps {
               sh '''
               cd php-terraform/terraform/php
               terraform init
               '''
            }
        }
          stage('terraform validate') {
            steps {
               sh '''
               cd php-terraform/terraform/php
               terraform validate
               '''
            }
        }
         stage('terraform plan') {
            steps {
               sh '''
               cd php-terraform/terraform/php
               terraform plan
               '''
            }
        }
        //  stage('terraform apply') {
        //     steps {
        //       sh '''
        //       cd php-terraform/terraform/php
        //       terraform apply
        //       '''
        //     }
        // }
         stage('Apply') {
                steps {  
                    timeout(time: 300, unit: 'SECONDS') {
 
                     script {                  
                    def USER_INPUT = input(
                    message: 'Please select the required input',
                    parameters: [
                            [$class: 'ChoiceParameterDefinition',
                             choices: ['Nothing','Apply','Destroy'].join('\n'),
                             name: 'input',
                             description: 'Menu - select box option']
                    ]
                    )

                    echo "The answer is: ${USER_INPUT}"

                    if( "${USER_INPUT}" == "Apply"){
                        //do something
                        terraform apply -auto-approve
                    } else if( "${USER_INPUT}" == "Destroy") {
                        //do something else
                       terraform destroy -auto-approve
                    } else {
                        
                            }
                        
                    
                }
                    }
            }
            }
    }
}
